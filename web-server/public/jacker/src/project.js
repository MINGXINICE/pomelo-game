require=function e(t,n,i){function a(s,c){if(!n[s]){if(!t[s]){var o="function"==typeof require&&require;if(!c&&o)return o(s,!0);if(r)return r(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return a(n||e)},l,l.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a}({Card:[function(e,t,n){"use strict";cc._RF.push(t,"eb631M8ZOtO6IBqapG1eAxa","Card"),cc.Class({extends:cc.Component,properties:{itemPrefab:cc.Prefab,Atlas:cc.SpriteAtlas},initSelfCard:function(e){for(var t=0;t<e.length;t++){var n=cc.instantiate(this.itemPrefab);n.setPosition(30*t,0),n.rotation=15*(t-1),n.getComponent(cc.Sprite).spriteFrame=this.Atlas.getSpriteFrame(e[t]+""),this.node.addChild(n,null,1001)}},initOpCard:function(e){for(var t=0;t<e.length;t++){var n=cc.instantiate(this.itemPrefab);n.setPosition(30*t,0),n.rotation=15*(t-1),n.getComponent(cc.Sprite).spriteFrame=1==t?this.Atlas.getSpriteFrame("53"):this.Atlas.getSpriteFrame(e[t]+""),this.node.addChild(n,null,1001)}},get:function(e,t){cc.log("lengt h"+t);var n=cc.instantiate(this.itemPrefab);n.setPosition(30*(t-1),0),n.rotation=10,n.getComponent(cc.Sprite).spriteFrame=this.Atlas.getSpriteFrame(e.card+""),this.trimCard(this.node),this.node.addChild(n,null,1001)},trimCard:function(e){for(var t=e.children,n=0;n<t.length;n++){var i=t[n].rotation;if(i<0){if(0==n&&i<=-5)continue;i+=5}else i-=5;t[n].rotation=i,cc.log(t[n].rotation)}},start:function(){}}),cc._RF.pop()},{}],Game:[function(e,t,n){"use strict";cc._RF.push(t,"9212bJLFaVLhrhNaS2nw6g9","Game");e("ImageLoader");cc.Class({extends:cc.Component,properties:{selfCardlist:cc.Node,selfHead:cc.Sprite,opHead:cc.Sprite,opCardlist:cc.Node,Atlas:cc.SpriteAtlas,star:cc.SpriteFrame,result:cc.Label,selfCards:[],opCards:[],audioBg:{default:null,url:cc.AudioClip},OP_INFO:null,SF_INFO:null,GAME_INFO:null},ctor:function(){},onLoad:function(){this.GAME_INFO={round:0,mTurn:!1};var e=window.location.href.split("?")[1],t=this;this.SF_INFO={uid:this.getValueByKey(e,"uid",0),rid:this.getValueByKey(e,"rid",0),gid:this.getValueByKey(e,"gid",0),iconUrl:this.getValueByKey(e,"iconUrl",""),winRound:0},this.connect();var n=3;this.schedule(function(){cc.log("倒计时"+n),cc.find("Canvas/overSprite/scheduleSprite").getComponent(cc.Sprite).spriteFrame=this.Atlas.getSpriteFrame(""+n),0==n&&(cc.find("Canvas/overSprite").active=!1,t.loadReadyMsg()),n--},1,3);var i=this.SF_INFO.iconUrl;i&&cc.loader.load(i,{isCrossOrigin:!0},function(e,n){console.log(e+"---"+n),t.selfHead.spriteFrame=new cc.SpriteFrame(n)}),cc.audioEngine.play(this.audioBg,!0)},connect:function(){var e=this;pomelo.init({host:"192.168.2.2",port:3050},function(){pomelo.request("connector.CS_erShiYiDianHandler.join",{username:e.SF_INFO.uid,rid:e.SF_INFO.rid,gid:e.SF_INFO.gid,iconUrl:e.SF_INFO.iconUrl,nickname:"miracle"},function(e){cc.log("connector.wuZiQiHandler.join success "+e.users)})}),pomelo.on("onmessage",function(t){var n=JSON.stringify(t);console.log("pomelo.on.message json:"+n);var i=JSON.parse(n),a=i.content;e.receiveMsg(i.msgId,a)})},initCard:function(e){cc.find("Canvas/sfRectangle").active=!0,cc.find("Canvas/opRectangle").active=!0,this.selfCards=e.self,this.opCards=e.op;var t=this.cela(this.selfCards),n="";n=1==t.length?t[0]:t[0]+"/"+t[1],cc.find("Canvas/sfRectangle/num").getComponent(cc.Label).string=n,n=1==(t=this.cela(this.opCards)).length?t[0]:t[0]+"/"+t[1],cc.find("Canvas/opRectangle/num").getComponent(cc.Label).string=n,this.selfCardlist.getComponent("Card").initSelfCard(this.selfCards),this.opCardlist.getComponent("Card").initOpCard(this.opCards)},getValueByKey:function(e,t,n){var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),a=e.match(i);return null!=a?unescape(decodeURIComponent(a[2])):n},loadReadyMsg:function(){this.sendMessage({msgId:104,content:{}})},resetRound:function(){cc.find("Canvas/result").active=!1,cc.find("Canvas/sfRectangle").active=!1,cc.find("Canvas/opRectangle").active=!1,this.selfCardlist.removeAllChildren(),this.opCardlist.removeAllChildren(),this.OP_INFO.stop=!1,this.GAME_INFO.round++},roundGo:function(){var e={msgId:101,content:{round:this.GAME_INFO.round}};this.sendMessage(e)},roundOver:function(e){var t={msgId:107,content:{winUid:e}};this.sendMessage(t)},takeCard:function(){var e={msgId:103,content:{round:this.GAME_INFO.round}};this.sendMessage(e)},stopCard:function(){var e={msgId:105,content:{round:this.GAME_INFO.round}};this.sendMessage(e)},turn:function(){this.GAME_INFO.mTurn?(cc.find("Canvas/btnGet").active=!0,cc.find("Canvas/btnStop").active=!0,cc.find("Canvas/waitText").active=!1):(cc.find("Canvas/btnGet").active=!1,cc.find("Canvas/btnStop").active=!1,cc.find("Canvas/waitText").active=!0)},addStar:function(e,t){for(var n=e.children,i=0;i<t;i++)n[i].getComponent(cc.Sprite).spriteFrame=this.star},sendMessage:function(e){var t=JSON.stringify(e.content);e.content=t;var n=JSON.stringify(e);pomelo.request("game.HS_erShiYiDianHandler.message",{data:n},function(e){cc.log(e)})},receiveMsg:function(e,t){var n=this;switch(e){case 204:this.GAME_INFO.round=t.round,this.roundGo();break;case 801:this.OP_INFO=JSON.parse(t),this.OP_INFO.winRound=0,this.OP_INFO.stop=!1;var i=this.OP_INFO.opPlayer.iconUrl;i&&cc.loader.load(i,function(e,t){n.opHead.spriteFrame=new cc.SpriteFrame(t)});break;case 201:t=JSON.parse(t),this.initCard(t),this.GAME_INFO.mTurn=t.turn,this.turn();break;case 203:this.selfCards.push(t.card),this.selfCardlist.getComponent("Card").get(t,this.selfCards.length);var a=this.cela(this.selfCards),r="";r=1==a.length?a[0]:a[0]+"/"+a[1],cc.find("Canvas/sfRectangle/num").getComponent(cc.Label).string=r,a.length>0?cc.log("玩家牌"+a):(cc.log("玩家爆牌"+this.OP_INFO.opPlayer.userId),this.roundOver(this.OP_INFO.opPlayer.userId));break;case 205:if(t.belong){if(this.OP_INFO.stop){var s=this.cela(this.selfCards),c=this.cela(this.opCards);s[s.length-1]<c[c.length-1]?(cc.log("自己输了"),this.roundOver(this.OP_INFO.opPlayer.userId)):(cc.log("自己赢了"),this.roundOver(this.SF_INFO.uid))}}else this.OP_INFO.stop=!0,this.GAME_INFO.mTurn=!0,this.turn();break;case 207:cc.find("Canvas/result").active=!0,t.win.split("*")[0]==this.SF_INFO.uid?(this.SF_INFO.winRound++,this.addStar(cc.find("Canvas/starSelf"),this.SF_INFO.winRound),this.result.string="赢"):(this.OP_INFO.winRound++,this.addStar(cc.find("Canvas/starOp"),this.OP_INFO.winRound),this.result.string="输"),this.schedule(function(){this.resetRound(),this.roundGo(),cc.find("Canvas/result").active=!1},3,0);break;case 208:this.GAME_INFO.mTurn=t.turn,this.turn();break;case 210:cc.log(t.win)}},cela:function(e){for(var t={A:0,value:0},n=0;n<e.length;n++){var i=e[n];i%13==1?t.A++:t.value+=i%13==10||i%13==11||i%13==12||i%13==0?10:i%13}var a=[];if(1==t.A){var r=[1,11],s=t.value;for(n=0;n<r.length;n++)s+r[n]<=21&&a.push(s+r[n])}else if(2==t.A)for(r=[2,12],s=t.value,n=0;n<r.length;n++)s+r[n]<=21&&a.push(s+r[n]);else if(3==t.A)for(r=[3,13],s=t.value,n=0;n<r.length;n++)s+r[n]<=21&&a.push(s+r[n]);else if(4==t.A)for(r=[4,14],s=t.value,n=0;n<r.length;n++)s+r[n]<=21&&a.push(s+r[n]);else{(s=t.value)<=21&&a.push(t.value)}return a},start:function(){}}),cc._RF.pop()},{ImageLoader:"ImageLoader"}],ImageLoader:[function(e,t,n){"use strict";cc._RF.push(t,"9ab19D6zIpAv6x1le3e0t7k","ImageLoader");var i={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){for(var t,n,a,r,s,c,o,d="",l=0;l<e.length;)r=(t=e[l++])>>2,s=(3&t)<<4|(n=e[l++])>>4,c=(15&n)<<2|(a=e[l++])>>6,o=63&a,isNaN(n)?c=o=64:isNaN(a)&&(o=64),d=d+i._keyStr.charAt(r)+i._keyStr.charAt(s)+i._keyStr.charAt(c)+i._keyStr.charAt(o);return d}},a={load:function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState&&n.status>=200&&n.status<400){var e=n.responseText,a=new Uint8Array(e);t(i.encode(a))}},n.open("GET",e,!0),n.send()}};t.exports=a,cc._RF.pop()},{}]},{},["Card","Game","ImageLoader"]);